var He=Object.defineProperty,We=Object.defineProperties;var Ve=Object.getOwnPropertyDescriptors;var we=Object.getOwnPropertySymbols;var qe=Object.prototype.hasOwnProperty,Ze=Object.prototype.propertyIsEnumerable;var _e=(e,n,a)=>n in e?He(e,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[n]=a,F=(e,n)=>{for(var a in n||(n={}))qe.call(n,a)&&_e(e,a,n[a]);if(we)for(var a of we(n))Ze.call(n,a)&&_e(e,a,n[a]);return e},Y=(e,n)=>We(e,Ve(n));var M=(e,n,a)=>new Promise((s,l)=>{var m=o=>{try{i(a.next(o))}catch(t){l(t)}},d=o=>{try{i(a.throw(o))}catch(t){l(t)}},i=o=>o.done?s(o.value):Promise.resolve(o.value).then(m,d);i((a=a.apply(e,n)).next())});import{p as b,as as $e,b as J,o as K,_ as H,al as ie,I as ke,at as Je,a1 as Xe,f as Qe,am as Ye,t as xe,a9 as et,a6 as tt,aq as nt,a8 as at}from"./index.js";import{u as be}from"./useFormItem-413320fc.js";import{aA as re,K as ne,ay as q,aB as Re,aC as ue,aD as ot,aE as Te,aF as ve,aG as lt,at as Pe,aH as st,W as Le,aI as rt,aJ as it,al as ge,aK as ut,aL as ct,aM as dt,$ as ae,aN as pt,aO as ft,aP as mt,aq as Ie,aQ as gt,aR as ht,aS as ce,aT as Ue}from"./antd-d44a863f.js";import{d as G,k as A,e as R,u as w,s as de,w as D,a8 as v,_ as S,a9 as $,aa as _,$ as z,ab as oe,F as x,E as N,a1 as E,ad as Z,af as pe,R as fe,ae as te,ah as me,f as h,a0 as Ce,o as Oe,p as yt,c as vt,J as Ae,a2 as he,ac as j,q as bt,r as Ct,H as St}from"./vue-625a50e2.js";import{R as wt}from"./RadioButtonGroup-8412b0f8.js";import{a as _t,B as De,b as Be,u as Fe}from"./index-0a9e2861.js";import{c as At}from"./index-1afce7c1.js";import{b as Ft}from"./uuid-31b8b5a4.js";import{d as $t}from"./download-3152d4ec.js";import{S as kt}from"./index-dfb5c92c.js";import{_ as Rt}from"./IconPicker.vue_vue_type_style_index_0_lang-319d661f.js";import{C as Tt}from"./index-c51e4158.js";const Pt=G({name:"ApiRadioGroup",components:{RadioGroup:re.Group,RadioButton:re.Button,Radio:re},props:{api:{type:Function,default:null},params:{type:[Object,String],default:()=>({})},value:{type:[String,Number,Boolean]},isBtn:{type:[Boolean],default:!1},numberToString:b.bool,resultField:b.string.def(""),labelField:b.string.def("label"),valueField:b.string.def("value"),immediate:b.bool.def(!0)},emits:["options-change","change"],setup(e,{emit:n}){const a=A([]),s=A(!1),l=A(!0),m=A([]),d=$e(),{t:i}=J(),[o]=be(e,"value","change",m),t=R(()=>{const{labelField:f,valueField:c,numberToString:p}=e;return w(a).reduce((U,T)=>{if(T){const L=T[c];U.push(F({label:T[f],value:p?`${L}`:L},ne(T,[f,c])))}return U},[])});de(()=>{e.immediate&&r()}),D(()=>e.params,()=>{!w(l)&&r()},{deep:!0});function r(){return M(this,null,function*(){const f=e.api;if(!(!f||!K(f))){a.value=[];try{s.value=!0;const c=yield f(e.params);if(Array.isArray(c)){a.value=c,u();return}e.resultField&&(a.value=q(c,e.resultField)||[]),u()}catch(c){console.warn(c)}finally{s.value=!1}}})}function u(){n("options-change",w(t))}function g(...f){m.value=f}return{state:o,getOptions:t,attrs:d,loading:s,t:i,handleClick:g,props:e}}});function Lt(e,n,a,s,l,m){const d=v("RadioButton"),i=v("Radio"),o=v("RadioGroup");return S(),$(o,Z(e.attrs,{value:e.state,"onUpdate:value":n[0]||(n[0]=t=>e.state=t),"button-style":"solid"}),{default:_(()=>[(S(!0),z(x,null,oe(e.getOptions,t=>(S(),z(x,{key:`${t.value}`},[e.props.isBtn?(S(),$(d,{key:0,value:t.value,disabled:t.disabled,onClick:r=>e.handleClick(t)},{default:_(()=>[N(E(t.label),1)]),_:2},1032,["value","disabled","onClick"])):(S(),$(i,{key:1,value:t.value,disabled:t.disabled,onClick:r=>e.handleClick(t)},{default:_(()=>[N(E(t.label),1)]),_:2},1032,["value","disabled","onClick"]))],64))),128))]),_:1},16,["value"])}const It=H(Pt,[["render",Lt]]),Ut=G({name:"ApiSelect",components:{Select:Re,LoadingOutlined:ue},inheritAttrs:!1,props:{value:[Array,Object,String,Number],numberToString:b.bool,api:{type:Function,default:null},params:b.any.def({}),resultField:b.string.def(""),labelField:b.string.def("label"),valueField:b.string.def("value"),immediate:b.bool.def(!0),alwaysLoad:b.bool.def(!1),options:b.array.def([])},emits:["options-change","change","update:value"],setup(e,{emit:n}){const a=A([]),s=A(!1),l=A(!0),m=A([]),d=$e(),{t:i}=J(),[o]=be(e,"value","change",m),t=R(()=>{const{labelField:c,valueField:p,numberToString:U}=e;let T=w(a).reduce((L,W)=>{if(W){const ee=q(W,p);L.push(Y(F({},ne(W,[c,p])),{label:q(W,c),value:U?`${ee}`:ee}))}return L},[]);return T.length>0?T:e.options});de(()=>{e.immediate&&!e.alwaysLoad&&r()}),D(()=>o.value,c=>{n("update:value",c)}),D(()=>e.params,()=>{!w(l)&&r()},{deep:!0});function r(){return M(this,null,function*(){const c=e.api;if(!(!c||!K(c))){a.value=[];try{s.value=!0;const p=yield c(e.params);if(Array.isArray(p)){a.value=p,g();return}e.resultField&&(a.value=q(p,e.resultField)||[]),g()}catch(p){console.warn(p)}finally{s.value=!1}}})}function u(c){return M(this,null,function*(){c&&(e.alwaysLoad?yield r():!e.immediate&&w(l)&&(yield r(),l.value=!1))})}function g(){n("options-change",w(t))}function f(c,...p){m.value=p}return{state:o,attrs:d,getOptions:t,loading:s,t:i,handleFetch:u,handleChange:f}}});function Ot(e,n,a,s,l,m){const d=v("LoadingOutlined"),i=v("Select");return S(),$(i,Z({onDropdownVisibleChange:e.handleFetch},e.$attrs,{onChange:e.handleChange,options:e.getOptions,value:e.state,"onUpdate:value":n[0]||(n[0]=o=>e.state=o)}),pe({_:2},[oe(Object.keys(e.$slots),o=>({name:o,fn:_(t=>[fe(e.$slots,o,te(me(t||{})))])})),e.loading?{name:"suffixIcon",fn:_(()=>[h(d,{spin:""})]),key:"0"}:void 0,e.loading?{name:"notFoundContent",fn:_(()=>[Ce("span",null,[h(d,{spin:"",class:"mr-1"}),N(" "+E(e.t("component.form.apiSelectNotFound")),1)])]),key:"1"}:void 0]),1040,["onDropdownVisibleChange","onChange","options","value"])}const Dt=H(Ut,[["render",Ot]]),Bt=G({name:"ApiTree",components:{ATree:ot,LoadingOutlined:ue},props:{api:{type:Function},params:{type:Object},immediate:{type:Boolean,default:!0},resultField:b.string.def(""),afterFetch:{type:Function}},emits:["options-change","change"],setup(e,{attrs:n,emit:a}){const s=A([]),l=A(!1),m=A(!1),d=R(()=>F(F({},e.api?{treeData:w(s)}:{}),n));function i(...t){a("change",...t)}D(()=>e.params,()=>{!w(l)&&o()},{deep:!0}),D(()=>e.immediate,t=>{t&&!l.value&&o()}),Oe(()=>{e.immediate&&o()});function o(){return M(this,null,function*(){const{api:t,afterFetch:r}=e;if(!t||!K(t))return;m.value=!0,s.value=[];let u;try{u=yield t(e.params)}catch(g){console.error(g)}r&&K(r)&&(u=r(u)),m.value=!1,u&&(ie(u)||(u=q(u,e.resultField)),s.value=u||[],l.value=!0,a("options-change",s.value))})}return{getAttrs:d,loading:m,handleChange:i}}});function Mt(e,n,a,s,l,m){const d=v("LoadingOutlined"),i=v("a-tree");return S(),$(i,Z(e.getAttrs,{onChange:e.handleChange}),pe({_:2},[oe(Object.keys(e.$slots),o=>({name:o,fn:_(t=>[fe(e.$slots,o,te(me(t||{})))])})),e.loading?{name:"suffixIcon",fn:_(()=>[h(d,{spin:""})]),key:"0"}:void 0]),1040,["onChange"])}const Nt=H(Bt,[["render",Mt]]),Et=G({name:"ApiTreeSelect",components:{ATreeSelect:Te,LoadingOutlined:ue},props:{api:{type:Function},params:{type:Object},immediate:{type:Boolean,default:!0},resultField:b.string.def("")},emits:["options-change","change"],setup(e,{attrs:n,emit:a}){const s=A([]),l=A(!1),m=A(!1),d=R(()=>F(F({},e.api?{treeData:w(s)}:{}),n));function i(...t){a("change",...t)}D(()=>e.params,()=>{!w(l)&&o()},{deep:!0}),D(()=>e.immediate,t=>{t&&!l.value&&o()}),Oe(()=>{e.immediate&&o()});function o(){return M(this,null,function*(){const{api:t}=e;if(!t||!K(t))return;m.value=!0,s.value=[];let r;try{r=yield t(e.params)}catch(u){console.error(u)}m.value=!1,r&&(ie(r)||(r=q(r,e.resultField)),s.value=r||[],l.value=!0,a("options-change",s.value))})}return{getAttrs:d,loading:m,handleChange:i}}});function Gt(e,n,a,s,l,m){const d=v("LoadingOutlined"),i=v("a-tree-select");return S(),$(i,Z(e.getAttrs,{onChange:e.handleChange}),pe({_:2},[oe(Object.keys(e.$slots),o=>({name:o,fn:_(t=>[fe(e.$slots,o,te(me(t||{})))])})),e.loading?{name:"suffixIcon",fn:_(()=>[h(d,{spin:""})]),key:"0"}:void 0]),1040,["onChange"])}const jt=H(Et,[["render",Gt]]),zt=G({name:"ApiCascader",components:{LoadingOutlined:ue,[ve.name]:ve},props:{value:{type:Array},api:{type:Function,default:null},numberToString:b.bool,resultField:b.string.def(""),labelField:b.string.def("label"),valueField:b.string.def("value"),childrenField:b.string.def("children"),asyncFetchParamKey:b.string.def("parentCode"),immediate:b.bool.def(!0),initFetchParams:{type:Object,default:()=>({})},isLeaf:{type:Function,default:null},displayRenderArray:{type:Array}},emits:["change","defaultChange"],setup(e,{emit:n}){const a=A([]),s=A([]),l=A(!1),m=A([]),d=A(!0),{t:i}=J(),[o]=be(e,"value","change",m);D(a,c=>{const p=t(c);s.value=p},{deep:!0});function t(c){const{labelField:p,valueField:U,numberToString:T,childrenField:L,isLeaf:W}=e;return c.reduce((ee,X)=>{if(X){const le=X[U],se=Y(F({},ne(X,[p,U])),{label:X[p],value:T?`${le}`:le,isLeaf:W&&typeof W=="function"?W(X):!1}),C=Reflect.get(X,L);C&&Reflect.set(se,L,t(C)),ee.push(se)}return ee},[])}function r(){return M(this,null,function*(){const c=e.api;if(!(!c||!K(c))){a.value=[],l.value=!0;try{const p=yield c(e.initFetchParams);if(Array.isArray(p)){a.value=p;return}e.resultField&&(a.value=q(p,e.resultField)||[])}catch(p){console.warn(p)}finally{l.value=!1}}})}function u(c){return M(this,null,function*(){const p=c[c.length-1];p.loading=!0;const U=e.api;if(!(!U||!K(U)))try{const T=yield U({[e.asyncFetchParamKey]:Reflect.get(p,"value")});if(Array.isArray(T)){const L=t(T);p.children=L;return}if(e.resultField){const L=t(q(T,e.resultField)||[]);p.children=L}}catch(T){console.error(T)}finally{p.loading=!1}})}de(()=>{e.immediate&&r()}),D(()=>e.initFetchParams,()=>{!w(d)&&r()},{deep:!0});function g(c,p){m.value=p,n("defaultChange",c,p)}function f({labels:c,selectedOptions:p}){return w(m).length===p.length?c.join(" / "):e.displayRenderArray?e.displayRenderArray.join(" / "):""}return{state:o,options:s,loading:l,t:i,handleChange:g,loadData:u,handleRenderDisplay:f}}});function Kt(e,n,a,s,l,m){const d=v("LoadingOutlined"),i=v("a-cascader");return S(),$(i,{value:e.state,"onUpdate:value":n[0]||(n[0]=o=>e.state=o),options:e.options,"load-data":e.loadData,"change-on-select":"",onChange:e.handleChange,displayRender:e.handleRenderDisplay},pe({_:2},[e.loading?{name:"suffixIcon",fn:_(()=>[h(d,{spin:""})]),key:"0"}:void 0,e.loading?{name:"notFoundContent",fn:_(()=>[Ce("span",null,[h(d,{spin:"",class:"mr-1"}),N(" "+E(e.t("component.form.apiSelectNotFound")),1)])]),key:"1"}:void 0]),1032,["value","options","load-data","onChange","displayRender"])}const Ht=H(zt,[["render",Kt]]),Wt=G({name:"ApiTransfer",components:{Transfer:lt},props:{value:{type:Array},api:{type:Function,default:null},params:{type:Object},dataSource:{type:Array},immediate:b.bool.def(!0),alwaysLoad:b.bool.def(!1),afterFetch:{type:Function},resultField:b.string.def(""),labelField:b.string.def("title"),valueField:b.string.def("key"),showSearch:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},filterOption:{type:Function},selectedKeys:{type:Array},showSelectAll:{type:Boolean,default:!1},targetKeys:{type:Array}},emits:["options-change","change"],setup(e,{attrs:n,emit:a}){const s=A([]),l=A([]),{t:m}=J(),d=R(()=>F(F({},e.api?{}:{dataSource:w(s)}),n)),i=R(()=>{const{labelField:g,valueField:f}=e;return w(s).reduce((c,p)=>(p&&c.push(Y(F({},ne(p,[g,f])),{title:p[g],key:p[f]})),c),[])}),o=R(()=>w(l).length>0?w(l):Array.isArray(e.value)?e.value:Array.isArray(e.targetKeys)?e.targetKeys:[]);function t(g,f,c){l.value=g,console.log(f),console.log(c),a("change",g)}de(()=>{e.immediate&&!e.alwaysLoad&&r()}),D(()=>e.params,()=>{r()},{deep:!0});function r(){return M(this,null,function*(){const g=e.api;if(!g||!K(g)){Array.isArray(e.dataSource)&&(s.value=e.dataSource);return}s.value=[];try{const f=yield g(e.params);if(Array.isArray(f)){s.value=f,u();return}e.resultField&&(s.value=q(f,e.resultField)||[]),u()}catch(f){console.warn(f)}})}function u(){a("options-change",w(i))}return{getTargetKeys:o,getdataSource:i,t:m,getAttrs:d,handleChange:t}}});function Vt(e,n,a,s,l,m){const d=v("Transfer");return S(),$(d,{"data-source":e.getdataSource,"filter-option":e.filterOption,render:i=>i.title,showSelectAll:e.showSelectAll,selectedKeys:e.selectedKeys,targetKeys:e.getTargetKeys,showSearch:e.showSearch,onChange:e.handleChange},null,8,["data-source","filter-option","render","showSelectAll","selectedKeys","targetKeys","showSearch","onChange"])}const qt=H(Wt,[["render",Vt]]),Me={helpText:{type:String,default:""},maxSize:{type:Number,default:2},maxNumber:{type:Number,default:1/0},accept:{type:Array,default:()=>[]},multiple:{type:Boolean,default:!0},uploadParams:{type:Object,default:()=>({})},api:{type:Function,default:null,required:!0},name:{type:String,default:"file"},filename:{type:String,default:null}},Zt=Y(F({value:{type:Array,default:()=>[]}},Me),{showPreviewNumber:{type:Boolean,default:!0},emptyHidePreview:{type:Boolean,default:!1}}),Jt={value:{type:Array,default:()=>[]}},Xt={columns:{type:Array,default:null},actionColumn:{type:Object,default:null},dataSource:{type:Array,default:null}},{t:ye}=J();function Qt({acceptRef:e,helpTextRef:n,maxNumberRef:a,maxSizeRef:s}){const l=R(()=>{const i=w(e);return i&&i.length>0?i:[]}),m=R(()=>w(l).map(i=>i.indexOf("/")>0||i.startsWith(".")?i:`.${i}`).join(",")),d=R(()=>{const i=w(n);if(i)return i;const o=[],t=w(e);t.length>0&&o.push(ye("component.upload.accept",[t.join(",")]));const r=w(s);r&&o.push(ye("component.upload.maxSize",[r]));const u=w(a);return u&&u!==1/0&&o.push(ye("component.upload.maxNumber",[u])),o.join("，")});return{getAccept:l,getStringAccept:m,getHelpText:d}}var P=(e=>(e.SUCCESS="success",e.ERROR="error",e.UPLOADING="uploading",e))(P||{});function Yt(e){return Ne(e.name)}function Ne(e){return/\.(jpg|jpeg|png|gif|webp)$/i.test(e)}function xt(e){return new Promise((n,a)=>{const s=new FileReader;s.readAsDataURL(e),s.onload=()=>n({result:s.result,file:e}),s.onerror=l=>a(l)})}const Ee=Symbol("basic-table");function Kn(e){yt(Ee,e)}function en(){return vt(Ee)}const{table:tn}=At,{pageSizeOptions:nn,defaultPageSize:an,fetchSetting:on,defaultSize:ln,defaultSortFn:sn,defaultFilterFn:rn}=tn,Hn="key",Wn=nn,Vn=an,qn=on,Zn=ln,Jn=sn,Xn=rn,Qn="center",Yn="INDEX",un="ACTION",cn=G({name:"TableAction",components:{Icon:ke,PopConfirmButton:Je,Divider:Pe,Dropdown:Xe,MoreOutlined:st,Tooltip:Le},props:{actions:{type:Array,default:null},dropDownActions:{type:Array,default:null},divider:b.bool.def(!0),outside:b.bool,stopButtonPropagation:b.bool.def(!1)},setup(e){const{prefixCls:n}=Qe("basic-table-action");let a={};e.outside||(a=en());const{hasPermission:s}=Ye();function l(r){const u=r.ifShow;let g=!0;return xe(u)&&(g=u),K(u)&&(g=u(r)),g}const m=R(()=>(Ae(e.actions)||[]).filter(r=>s(r.auth)&&l(r)).map(r=>{const{popConfirm:u}=r;return Y(F(F({getPopupContainer:()=>{var g;return(g=w(a==null?void 0:a.wrapRef))!=null?g:document.body},type:"link",size:"small"},r),u||{}),{onConfirm:u==null?void 0:u.confirm,onCancel:u==null?void 0:u.cancel,enable:!!u})})),d=R(()=>{const r=(Ae(e.dropDownActions)||[]).filter(u=>s(u.auth)&&l(u));return r.map((u,g)=>{const{label:f,popConfirm:c}=u;return Y(F(F({},u),c),{onConfirm:c==null?void 0:c.confirm,onCancel:c==null?void 0:c.cancel,text:f,divider:g<r.length-1?e.divider:!1})})}),i=R(()=>{var g,f;const u=(((g=a==null?void 0:a.getColumns)==null?void 0:g.call(a))||[]).find(c=>c.flag===un);return(f=u==null?void 0:u.align)!=null?f:"left"});function o(r){return F({getPopupContainer:()=>{var u;return(u=w(a==null?void 0:a.wrapRef))!=null?u:document.body},placement:"bottom"},et(r)?{title:r}:r)}function t(r){if(!e.stopButtonPropagation)return;r.composedPath().find(f=>{var c;return((c=f.tagName)==null?void 0:c.toUpperCase())==="BUTTON"})&&r.stopPropagation()}return{prefixCls:n,getActions:m,getDropdownList:d,getAlign:i,onCellClick:t,getTooltip:o}}});function dn(e,n,a,s,l,m){const d=v("Icon"),i=v("PopConfirmButton"),o=v("Tooltip"),t=v("Divider"),r=v("MoreOutlined"),u=v("a-button"),g=v("Dropdown");return S(),z("div",{class:he([e.prefixCls,e.getAlign]),onClick:n[0]||(n[0]=(...f)=>e.onCellClick&&e.onCellClick(...f))},[(S(!0),z(x,null,oe(e.getActions,(f,c)=>(S(),z(x,{key:`${c}-${f.label}`},[f.tooltip?(S(),$(o,te(Z({key:0},e.getTooltip(f.tooltip))),{default:_(()=>[h(i,te(me(f)),{default:_(()=>[f.icon?(S(),$(d,{key:0,icon:f.icon,class:he({"mr-1":!!f.label})},null,8,["icon","class"])):j("",!0),f.label?(S(),z(x,{key:1},[N(E(f.label),1)],64)):j("",!0)]),_:2},1040)]),_:2},1040)):(S(),$(i,te(Z({key:1},f)),{default:_(()=>[f.icon?(S(),$(d,{key:0,icon:f.icon,class:he({"mr-1":!!f.label})},null,8,["icon","class"])):j("",!0),f.label?(S(),z(x,{key:1},[N(E(f.label),1)],64)):j("",!0)]),_:2},1040)),e.divider&&c<e.getActions.length-1?(S(),$(t,{key:2,type:"vertical",class:"action-divider"})):j("",!0)],64))),128)),e.dropDownActions&&e.getDropdownList.length>0?(S(),$(g,{key:0,trigger:["hover"],dropMenuList:e.getDropdownList,popconfirm:""},{default:_(()=>[fe(e.$slots,"more"),e.$slots.more?j("",!0):(S(),$(u,{key:0,type:"link",size:"small"},{default:_(()=>[h(r,{class:"icon-more"})]),_:1}))]),_:3},8,["dropMenuList"])):j("",!0)],2)}const Ge=H(cn,[["render",dn]]),pn=G({components:{Image:rt},props:{fileUrl:b.string.def(""),fileName:b.string.def("")}});const fn={class:"thumb"};function mn(e,n,a,s,l,m){const d=v("Image");return S(),z("span",fn,[e.fileUrl?(S(),$(d,{key:0,src:e.fileUrl,width:104},null,8,["src"])):j("",!0)])}const je=H(pn,[["render",mn]]),{t:I}=J();function gn(){return[{dataIndex:"thumbUrl",title:I("component.upload.legend"),width:100,customRender:({record:e})=>{const{thumbUrl:n}=e||{};return n&&h(je,{fileUrl:n},null)}},{dataIndex:"name",title:I("component.upload.fileName"),align:"left",customRender:({text:e,record:n})=>{const{percent:a,status:s}=n||{};let l="normal";return s===P.ERROR?l="exception":s===P.UPLOADING?l="active":s===P.SUCCESS&&(l="success"),h("span",null,[h("p",{class:"truncate mb-1",title:e},[e]),h(it,{percent:a,size:"small",status:l},null)])}},{dataIndex:"size",title:I("component.upload.fileSize"),width:100,customRender:({text:e=0})=>e&&(e/1024).toFixed(2)+"KB"},{dataIndex:"status",title:I("component.upload.fileStatue"),width:100,customRender:({text:e})=>e===P.SUCCESS?h(ge,{color:"green"},{default:()=>I("component.upload.uploadSuccess")}):e===P.ERROR?h(ge,{color:"red"},{default:()=>I("component.upload.uploadError")}):e===P.UPLOADING?h(ge,{color:"blue"},{default:()=>I("component.upload.uploading")}):e}]}function hn(e){return{width:120,title:I("component.upload.operating"),dataIndex:"action",fixed:!1,customRender:({record:n})=>{const a=[{label:I("component.upload.del"),color:"error",onClick:e.bind(null,n)}];return h(Ge,{actions:a,outside:!0},null)}}}function yn(){return[{dataIndex:"url",title:I("component.upload.legend"),width:100,customRender:({record:e})=>{const{url:n}=e||{};return Ne(n)&&h(je,{fileUrl:n},null)}},{dataIndex:"name",title:I("component.upload.fileName"),align:"left"}]}function vn({handleRemove:e,handleDownload:n}){return{width:160,title:I("component.upload.operating"),dataIndex:"action",fixed:!1,customRender:({record:a})=>{const s=[{label:I("component.upload.del"),color:"error",onClick:e.bind(null,a)},{label:I("component.upload.download"),onClick:n.bind(null,a)}];return h(Ge,{actions:s,outside:!0},null)}}}const ze=G({name:"FileList",props:Xt,setup(e){const n=_t();return D(()=>e.dataSource,()=>{bt(()=>{var a;(a=n==null?void 0:n.redoModalHeight)==null||a.call(n)})}),()=>{const{columns:a,actionColumn:s,dataSource:l}=e,m=[...a,s];return h("table",{class:"file-table"},[h("colgroup",null,[m.map(d=>{const{width:i=0,dataIndex:o}=d,t={width:`${i}px`,minWidth:`${i}px`};return h("col",{style:i?t:{},key:o},null)})]),h("thead",null,[h("tr",{class:"file-table-tr"},[m.map(d=>{const{title:i="",align:o="center",dataIndex:t}=d;return h("th",{class:["file-table-th",o],key:t},[i])})])]),h("tbody",null,[l.map((d={},i)=>h("tr",{class:"file-table-tr",key:`${i+d.name||""}`},[m.map(o=>{const{dataIndex:t="",customRender:r,align:u="center"}=o,g=r&&K(r);return h("td",{class:["file-table-td",u],key:t},[g?r==null?void 0:r({text:d[t],record:d}):d[t]])})]))])])}}});const bn=G({components:{BasicModal:De,Upload:ut,Alert:ct,FileList:ze},props:Y(F({},Me),{previewFileList:{type:Array,default:()=>[]}}),emits:["change","register","delete"],setup(e,{emit:n}){const a=Ct({fileList:[]}),s=A(!1),l=A([]),{accept:m,helpText:d,maxNumber:i,maxSize:o}=St(e),{t}=J(),[r,{closeModal:u}]=Be(),{getStringAccept:g,getHelpText:f}=Qt({acceptRef:m,helpTextRef:d,maxNumberRef:i,maxSizeRef:o}),{createMessage:c}=tt(),p=R(()=>l.value.length>0&&!l.value.every(C=>C.status===P.SUCCESS)),U=R(()=>{const C=l.value.some(k=>k.status===P.SUCCESS);return{disabled:s.value||l.value.length===0||!C}}),T=R(()=>{const C=l.value.some(k=>k.status===P.ERROR);return s.value?t("component.upload.uploading"):t(C?"component.upload.reUploadFailed":"component.upload.startUpload")});function L(C){const{size:k,name:O}=C,{maxSize:B}=e;if(B&&C.size/1024/1024>=B)return c.error(t("component.upload.maxSizeMultiple",[B])),!1;const V={uuid:Ft(),file:C,size:k,name:O,percent:0,type:O.split(".").pop()};return Yt(C)?xt(C).then(({result:Q})=>{l.value=[...w(l),F({thumbUrl:Q},V)]}):l.value=[...w(l),V],!1}function W(C){const k=l.value.findIndex(O=>O.uuid===C.uuid);k!==-1&&l.value.splice(k,1),n("delete",C)}function ee(C){return M(this,null,function*(){var O;const{api:k}=e;if(!k||!K(k))return nt("upload api must exist and be a function");try{C.status=P.UPLOADING;const B=yield(O=e.api)==null?void 0:O.call(e,{data:F({},e.uploadParams||{}),file:C.file,name:e.name,filename:e.filename},function(Se){const Ke=Se.loaded/Se.total*100|0;C.percent=Ke}),{data:V}=B;return C.status=P.SUCCESS,C.responseData=V,{success:!0,error:null}}catch(B){return console.log(B),C.status=P.ERROR,{success:!1,error:B}}})}function X(){return M(this,null,function*(){var k;const{maxNumber:C}=e;if(l.value.length+((k=e.previewFileList)==null?void 0:k.length)>C)return c.warning(t("component.upload.maxNumber",[C]));try{s.value=!0;const O=l.value.filter(Q=>Q.status!==P.SUCCESS)||[],B=yield Promise.all(O.map(Q=>ee(Q)));s.value=!1;const V=B.filter(Q=>!Q.success);if(V.length>0)throw V}catch(O){throw s.value=!1,O}})}function le(){const{maxNumber:C}=e;if(l.value.length>C)return c.warning(t("component.upload.maxNumber",[C]));if(s.value)return c.warning(t("component.upload.saveWarn"));const k=[];for(const O of l.value){const{status:B,responseData:V}=O;B===P.SUCCESS&&V&&k.push(V.url)}if(k.length<=0)return c.warning(t("component.upload.saveError"));l.value=[],u(),n("change",k)}function se(){return M(this,null,function*(){return s.value?(c.warning(t("component.upload.uploadWait")),!1):(l.value=[],!0)})}return{columns:gn(),actionColumn:hn(W),register:r,closeModal:u,getHelpText:f,getStringAccept:g,getOkButtonProps:U,beforeUpload:L,fileListRef:l,state:a,isUploadingRef:s,handleStartUpload:X,handleOk:le,handleCloseFunc:se,getIsSelectFile:p,getUploadBtnText:T,t}}});const Cn={class:"upload-modal-toolbar"};function Sn(e,n,a,s,l,m){const d=v("a-button"),i=v("Alert"),o=v("Upload"),t=v("FileList"),r=v("BasicModal");return S(),$(r,Z({width:"800px",title:e.t("component.upload.upload"),okText:e.t("component.upload.save")},e.$attrs,{onRegister:e.register,onOk:e.handleOk,closeFunc:e.handleCloseFunc,maskClosable:!1,keyboard:!1,class:"upload-modal",okButtonProps:e.getOkButtonProps,cancelButtonProps:{disabled:e.isUploadingRef}}),{centerFooter:_(()=>[h(d,{onClick:e.handleStartUpload,color:"success",disabled:!e.getIsSelectFile,loading:e.isUploadingRef},{default:_(()=>[N(E(e.getUploadBtnText),1)]),_:1},8,["onClick","disabled","loading"])]),default:_(()=>[Ce("div",Cn,[h(i,{message:e.getHelpText,type:"info",banner:"",class:"upload-modal-toolbar__text"},null,8,["message"]),h(o,{accept:e.getStringAccept,multiple:e.multiple,"before-upload":e.beforeUpload,"show-upload-list":!1,class:"upload-modal-toolbar__btn"},{default:_(()=>[h(d,{type:"primary"},{default:_(()=>[N(E(e.t("component.upload.choose")),1)]),_:1})]),_:1},8,["accept","multiple","before-upload"])]),h(t,{dataSource:e.fileListRef,columns:e.columns,actionColumn:e.actionColumn},null,8,["dataSource","columns","actionColumn"])]),_:1},16,["title","okText","onRegister","onOk","closeFunc","okButtonProps","cancelButtonProps"])}const wn=H(bn,[["render",Sn]]),_n=G({components:{BasicModal:De,FileList:ze},props:Jt,emits:["list-change","register","delete"],setup(e,{emit:n}){const[a,{closeModal:s}]=Be(),{t:l}=J(),m=A([]);D(()=>e.value,o=>{ie(o)||(o=[]),m.value=o.filter(t=>!!t).map(t=>({url:t,type:t.split(".").pop()||"",name:t.split("/").pop()||""}))},{immediate:!0});function d(o){const t=m.value.findIndex(r=>r.url===o.url);if(t!==-1){const r=m.value.splice(t,1);n("delete",r[0].url),n("list-change",m.value.map(u=>u.url))}}function i(o){const{url:t=""}=o;$t({url:t})}return{t:l,register:a,closeModal:s,fileListRef:m,columns:yn(),actionColumn:vn({handleRemove:d,handleDownload:i})}}});function An(e,n,a,s,l,m){const d=v("FileList"),i=v("BasicModal");return S(),$(i,Z({width:"800px",title:e.t("component.upload.preview"),class:"upload-preview-modal"},e.$attrs,{onRegister:e.register,showOkBtn:!1}),{default:_(()=>[h(d,{dataSource:e.fileListRef,columns:e.columns,actionColumn:e.actionColumn},null,8,["dataSource","columns","actionColumn"])]),_:1},16,["title","onRegister"])}const Fn=H(_n,[["render",An]]),$n=G({name:"BasicUpload",components:{UploadModal:wn,Space:dt,UploadPreviewModal:Fn,Icon:ke,Tooltip:Le},props:Zt,emits:["change","delete","preview-delete","update:value"],setup(e,{emit:n,attrs:a}){const{t:s}=J(),[l,{openModal:m}]=Fe(),[d,{openModal:i}]=Fe(),o=A([]),t=R(()=>{const{emptyHidePreview:p}=e;return p&&p?o.value.length>0:!0}),r=R(()=>{const p=F(F({},a),e);return ne(p,"onChange")});D(()=>e.value,(p=[])=>{o.value=ie(p)?p:[]},{immediate:!0});function u(p){o.value=[...w(o),...p||[]],n("update:value",o.value),n("change",o.value)}function g(p){o.value=[...p||[]],n("update:value",o.value),n("change",o.value)}function f(p){n("delete",p)}function c(p){n("preview-delete",p)}return{registerUploadModal:l,openUploadModal:m,handleChange:u,handlePreviewChange:g,registerPreviewModal:d,openPreviewModal:i,fileList:o,showPreview:t,bindValue:r,handleDelete:f,handlePreviewDelete:c,t:s}}});function kn(e,n,a,s,l,m){const d=v("a-button"),i=v("Icon"),o=v("Tooltip"),t=v("Space"),r=v("UploadModal"),u=v("UploadPreviewModal");return S(),z("div",null,[h(t,null,{default:_(()=>[h(d,{type:"primary",onClick:e.openUploadModal,preIcon:"carbon:cloud-upload"},{default:_(()=>[N(E(e.t("component.upload.upload")),1)]),_:1},8,["onClick"]),e.showPreview?(S(),$(o,{key:0,placement:"bottom"},{title:_(()=>[N(E(e.t("component.upload.uploaded"))+" ",1),e.fileList.length?(S(),z(x,{key:0},[N(E(e.fileList.length),1)],64)):j("",!0)]),default:_(()=>[h(d,{onClick:e.openPreviewModal},{default:_(()=>[h(i,{icon:"bi:eye"}),e.fileList.length&&e.showPreviewNumber?(S(),z(x,{key:0},[N(E(e.fileList.length),1)],64)):j("",!0)]),_:1},8,["onClick"])]),_:1})):j("",!0)]),_:1}),h(r,Z(e.bindValue,{previewFileList:e.fileList,onRegister:e.registerUploadModal,onChange:e.handleChange,onDelete:e.handleDelete}),null,16,["previewFileList","onRegister","onChange","onDelete"]),h(u,{value:e.fileList,onRegister:e.registerPreviewModal,onListChange:e.handlePreviewChange,onDelete:e.handlePreviewDelete},null,8,["value","onRegister","onListChange","onDelete"])])}const Rn=H($n,[["render",kn]]),Tn=at(Rn),y=new Map;y.set("Input",ae);y.set("InputGroup",ae.Group);y.set("InputPassword",ae.Password);y.set("InputSearch",ae.Search);y.set("InputTextArea",ae.TextArea);y.set("InputNumber",pt);y.set("AutoComplete",ft);y.set("Select",Re);y.set("ApiSelect",Dt);y.set("ApiTree",Nt);y.set("TreeSelect",Te);y.set("ApiTreeSelect",jt);y.set("ApiRadioGroup",It);y.set("Switch",mt);y.set("RadioButtonGroup",wt);y.set("RadioGroup",re.Group);y.set("Checkbox",Ie);y.set("CheckboxGroup",Ie.Group);y.set("ApiCascader",Ht);y.set("Cascader",ve);y.set("Slider",gt);y.set("Rate",ht);y.set("ApiTransfer",qt);y.set("DatePicker",ce);y.set("MonthPicker",ce.MonthPicker);y.set("RangePicker",ce.RangePicker);y.set("WeekPicker",ce.WeekPicker);y.set("TimePicker",Ue);y.set("TimeRangePicker",Ue.TimeRangePicker);y.set("StrengthMeter",kt);y.set("IconPicker",Rt);y.set("InputCountDown",Tt);y.set("Upload",Tn);y.set("Divider",Pe);function xn(e,n){y.set(e,n)}export{un as A,Tn as B,Qn as D,qn as F,Yn as I,Vn as P,Hn as R,Ge as T,Wn as a,Dt as b,Kn as c,jt as d,It as e,Jn as f,Xn as g,Zn as h,y as i,xn as j,en as u};
