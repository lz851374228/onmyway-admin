var T=(x,_,p)=>new Promise((C,f)=>{var b=l=>{try{u(p.next(l))}catch(t){f(t)}},k=l=>{try{u(p.throw(l))}catch(t){f(t)}},u=l=>l.done?C(l.value):Promise.resolve(l.value).then(b,k);u((p=p.apply(x,_)).next())});import $ from"./CollapseItem-dee9c25d.js";import q from"./FormComponentPanel-b66d82fa.js";import U from"./JsonModal-e9becba9.js";import Q from"./index-b3cdda14.js";import{_ as X}from"./useForm.vue_vue_type_script_setup_true_lang-e733ccc6.js";import Y from"./Toolbar-36afe187.js";import Z from"./PropsPanel-43da1a1b.js";import ee from"./ImportJsonModal-6bf1e49b.js";import oe from"./CodeModal-d91cc27c.js";import"./index-44546e2d.js";import{g as F,a as te}from"./index-803c64a0.js";import{b as re,a as ne,l as se}from"./formItemConfig-7a2acbe6.js";import{f as ae,bh as le,_ as ie}from"./index.js";import{g as me}from"./formItemPropsConfig-6a6fcf6b.js";import{d as H}from"./index-1afce7c1.js";import{u as pe}from"./template-c6c55654.js";import{d as ue,k as i,p as P,ai as de,o as ce,b as fe,_ as ve,$ as he,f as n,aa as m,u as s,a2 as z,af as ye,ab as ge,R as Pe,ae as _e,ah as Ce,F as be}from"./vue-625a50e2.js";import{M as c,bD as E,bE as ke,a0 as Ie}from"./antd-d44a863f.js";import"./vuedraggable.umd-bfbeaecf.js";import"./LayoutItem-89368b9c.js";import"./FormNode-02c2c64c.js";import"./FormNodeOperate-a59e2458.js";import"./useFormDesignState-40932730.js";import"./index-5e22aaa9.js";import"./componentMap-db59878c.js";import"./useFormItem-413320fc.js";import"./RadioButtonGroup-8412b0f8.js";import"./index-0a9e2861.js";import"./useWindowSizeFn-6fb3a97e.js";import"./uuid-31b8b5a4.js";import"./download-3152d4ec.js";import"./base64Conver-39fc0d26.js";import"./index-dfb5c92c.js";import"./IconPicker.vue_vue_type_style_index_0_lang-319d661f.js";import"./useCopyToClipboard-2275284e.js";import"./index-c51e4158.js";import"./index-8f3da8aa.js";import"./PreviewCode-3e989729.js";import"./index-2afe09f1.js";import"./FormRender-c8c68f8d.js";import"./BasicForm-e261a333.js";import"./FormItem.vue_vue_type_script_lang-c8c36622.js";import"./helper-d16d18bc.js";import"./BasicForm.vue_vue_type_style_index_0_lang-03718be0.js";import"./uniqBy-19b91793.js";import"./useForm-84c9b2f9.js";import"./FormProps-e0532e3c.js";import"./FormItemProps-acbfc887.js";import"./RuleProps-5af6f1c1.js";import"./ComponentProps-50a3af5f.js";import"./FormOptions-dfeb8c12.js";import"./FormItemColumnProps-40a9e41e.js";const Me=ue({__name:"index",props:{title:{type:String,default:"v-form-antd表单设计器"}},setup(x){const{prefixCls:_}=ae("form-design"),p=i(null),C=i(null),f=i(null),b=i(null),k=i(null),u=i(null),l=i({}),t=i({schemas:[],layout:"horizontal",labelLayout:"flex",labelWidth:100,labelCol:{},wrapperCol:{},currentItem:{component:"",componentProps:{}},activeKey:1}),O=o=>{o.schemas=o.schemas||[],o.schemas.forEach(e=>{e.colProps=e.colProps||{span:24},e.componentProps=e.componentProps||{},e.itemProps=e.itemProps||{}}),t.value=o},W=le(t,{deep:!0,capacity:20,parse:o=>{const e=c(o),{currentItem:r,schemas:a}=e,y=a&&a.find(d=>d.key===(r==null?void 0:r.key));return y&&(e.currentItem=y),e}}),v=o=>{t.value.currentItem=o,B(o.key?t.value.activeKey===1?2:t.value.activeKey:1)},A=o=>{o.colProps=o.colProps||{},o.colProps.span=me.span},I=(o,e)=>{},w=o=>{const e=c(o);return A(e),F(e),e},M=o=>{var r;const e=c(o);if(A(e),F(e),!((r=t.value.currentItem)!=null&&r.key)){v(e),t.value.schemas&&t.value.schemas.push(e);return}K(e,!1)},j=o=>{const e=c(o);return e.component==="Grid"&&te([o],r=>{F(r)}),e},K=(o=t.value.currentItem,e=!0)=>{var y;const r=(y=t.value.currentItem)==null?void 0:y.key,a=d=>{d.some((g,L)=>{var R;if(console.log("traverse",o,r,g),g.key===r){e?d.splice(L,0,j(g)):d.splice(L+1,0,o);const S={newIndex:L+1};return D(S,d,e),!0}["Grid","Tabs"].includes(g.component)&&((R=g.columns)==null||R.forEach(S=>{a(S.children)}))})};t.value.schemas&&a(t.value.schemas)},D=({newIndex:o},e,r=!1)=>{const a=e[o];r&&F(a),v(a)},h=o=>{const e=c(t.value);o==null||o.showModal(e)},B=o=>{t.value.activeKey=o},G=()=>{t.value.schemas=[],v({component:""})},V=(o,e)=>l.value[o]=e;P("formModel",l),P("setFormModelMethod",V),P("formConfig",t),P("historyReturn",W),P("formDesignMethods",{handleBeforeColAdd:D,handleCopy:K,handleListPush:M,handleSetSelectItem:v,handleAddAttrs:I,setFormConfig:O});const N=de();let J=null;return ce(()=>{var e;const o=parseInt((e=N.query)==null?void 0:e.id);J=o&&setInterval(()=>T(this,null,function*(){let r=c(t.value);yield pe({id:o,schemas:JSON.stringify(r)})}),2e3)}),fe(()=>{clearInterval(J)}),(o,e)=>(ve(),he(be,null,[n(s(Ie),null,{default:m(()=>[n(s(E),{class:z(`left ${s(_)}-sider`),collapsible:"",collapsedWidth:"0",width:"270",zeroWidthTriggerStyle:{"margin-top":"-70px","background-color":"gray"},breakpoint:"md"},{default:m(()=>[n(s(H),{title:"基础控件"},{default:m(()=>[n($,{list:s(re),handleListPush:w,onAddAttrs:I,onHandleListPush:M},null,8,["list"])]),_:1}),n(s(H),{title:"自定义控件"},{default:m(()=>[n($,{list:s(ne),onAddAttrs:I,handleListPush:w,onHandleListPush:M},null,8,["list"])]),_:1}),n(s(H),{title:"布局控件"},{default:m(()=>[n($,{list:s(se),handleListPush:w,onAddAttrs:I,onHandleListPush:M},null,8,["list"])]),_:1})]),_:1},8,["class"]),n(s(ke),null,{default:m(()=>[n(Y,{onHandleOpenJsonModal:e[0]||(e[0]=r=>h(C.value)),onHandleOpenImportJsonModal:e[1]||(e[1]=r=>h(f.value)),onHandlePreview:e[2]||(e[2]=r=>h(b.value)),onHandlePreview2:e[3]||(e[3]=r=>h(k.value)),onHandleOpenCodeModal:e[4]||(e[4]=r=>h(u.value)),onHandleClearFormItems:G}),n(q,{"current-item":t.value.currentItem,data:t.value,onHandleSetSelectItem:v},null,8,["current-item","data"])]),_:1}),n(s(E),{class:z(`right ${s(_)}-sider`),collapsible:"",reverseArrow:!0,collapsedWidth:"0",width:"270",zeroWidthTriggerStyle:{"margin-top":"-70px","background-color":"gray"},breakpoint:"lg"},{default:m(()=>[n(Z,{ref_key:"propsPanel",ref:p,activeKey:t.value.activeKey},ye({_:2},[ge(t.value.schemas,r=>({name:`${r.component}Props`,fn:m(a=>[Pe(o.$slots,`${r.component}Props`,_e(Ce({formItem:a,props:a.componentProps})),void 0,!0)])}))]),1032,["activeKey"])]),_:3},8,["class"])]),_:3}),n(U,{ref_key:"jsonModal",ref:C},null,512),n(oe,{ref_key:"codeModal",ref:u},null,512),n(ee,{ref_key:"importJsonModal",ref:f},null,512),n(Q,{ref_key:"eFormPreview",ref:b,formConfig:t.value},null,8,["formConfig"]),n(X,{ref_key:"eFormPreview2",ref:k,formConfig:t.value},null,8,["formConfig"])],64))}});const Fo=ie(Me,[["__scopeId","data-v-d7166266"]]);export{Fo as default};
