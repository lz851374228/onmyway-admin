var q=Object.defineProperty,x=Object.defineProperties;var U=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var b=(e,t,s)=>t in e?q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,p=(e,t)=>{for(var s in t||(t={}))$.call(t,s)&&b(e,s,t[s]);if(M)for(var s of M(t))C.call(t,s)&&b(e,s,t[s]);return e},y=(e,t)=>x(e,U(t));var g=(e,t,s)=>new Promise((a,l)=>{var f=n=>{try{i(s.next(n))}catch(m){l(m)}},d=n=>{try{i(s.throw(n))}catch(m){l(m)}},i=n=>n.done?a(n.value):Promise.resolve(n.value).then(f,d);i((s=s.apply(e,t)).next())});import{B as L,b as O}from"./index-0a9e2861.js";import{B as R}from"./BasicForm-e261a333.js";import"./componentMap-db59878c.js";import{u as T}from"./useForm-84c9b2f9.js";import"./RadioButtonGroup-8412b0f8.js";import{g as E}from"./role-91c3552f.js";import{d as u,_ as D}from"./index.js";import{g as j}from"./dept-80fca393.js";import{d as N,k as w,u as _,e as V,a8 as I,_ as z,a9 as G,aa as H,f as W,ad as J}from"./vue-625a50e2.js";const K=e=>u.post({url:"/system/user/create",data:e},{successMessageMode:"message",errorMessageMode:"message"}),Q=e=>u.post({url:"/system/user/update",data:e},{successMessageMode:"message",errorMessageMode:"message"}),X=e=>u.get({url:"/system/user/read",params:e}),me=e=>u.get({url:"/system/user/del",params:e},{successMessageMode:"message",errorMessageMode:"message"}),pe=e=>u.get({url:"/system/user/list",params:e}),Y=e=>u.post({url:"/system/user/userExist",params:{username:e}},{errorMessageMode:"none"}),fe=[{title:"用户名",dataIndex:"username",width:120},{title:"昵称",dataIndex:"nickname",width:120},{title:"邮箱",dataIndex:"email",width:120},{title:"创建时间",dataIndex:"created_at",width:180},{title:"角色",dataIndex:"role",width:200},{title:"备注",dataIndex:"remark"}],ge=[{field:"account",label:"用户名",component:"Input",colProps:{span:8}},{field:"nickname",label:"昵称",component:"Input",colProps:{span:8}}],v=[{field:"username",label:"用户名",component:"Input",helpMessage:["本字段进行唯一验证，保存后无法修改","不能输入带有admin的用户名"],rules:[{required:!0,message:"请输入用户名"},{validator(e,t){return new Promise((s,a)=>{Y(t).then(()=>s()).catch(l=>{a(l.message||"验证失败")})})}}]},{field:"pwd",label:"密码",component:"InputPassword",required:!0,ifShow:!1},{label:"角色",field:"role",component:"ApiSelect",componentProps:{mode:"multiple",api:E,labelField:"name",valueField:"id"},required:!0},{field:"dept",label:"所属部门",component:"TreeSelect",componentProps:{fieldNames:{label:"name",key:"id",value:"id"},getPopupContainer:()=>document.body},required:!0},{field:"nickname",label:"昵称",component:"Input",required:!0},{label:"邮箱",field:"email",component:"Input",required:!0},{label:"手机号",field:"phone",component:"Input",rules:[{required:!0,message:"请输入手机号"},{pattern:/^1([358][0-9]|4[579]|66|7[0135678]|9[89])[0-9]{8}$/i,message:"手机格式不正确"}]},{label:"备注",field:"remark",component:"InputTextArea"}],Z=N({name:"AccountModal",components:{BasicModal:L,BasicForm:R},emits:["success","register"],setup(e,{emit:t}){const s=w(!0),a=w(""),[l,{setFieldsValue:f,updateSchema:d,resetSchema:i,resetFields:n,validate:m}]=T({labelWidth:100,baseColProps:{span:24},schemas:v,showActionButtonGroup:!1,actionColOptions:{span:23}}),[P,{setModalProps:h,closeModal:B}]=O(o=>g(this,null,function*(){if(n(),h({confirmLoading:!1}),s.value=!!(o!=null&&o.isUpdate),_(s)){a.value=o.record.id;const c=yield F(a.value);yield d([{field:"username",label:"用户名",component:"Input",helpMessage:["无法修改用户名"],componentProps:{disabled:!0},rules:[],required:!1}]),f(p({},c))}else i(v);const r=yield j();d([{field:"pwd",show:!_(s)},{field:"dept",componentProps:{treeData:r}}])})),F=o=>g(this,null,function*(){let r=yield X({id:o});if(r.sys_department_users&&r.sys_department_users.length>0&&(r.dept=r.sys_department_users[0].sys_department_id),r.sys_role_users&&r.sys_role_users.length>0){let c=[];r.sys_role_users.forEach(A=>{c.push(A.sys_role_id)}),r.role=c}return r}),k=V(()=>_(s)?"编辑账号":"新增账号");function S(){return g(this,null,function*(){try{const o=yield m();if(h({confirmLoading:!0}),console.log(o),o.role&&o.role.length>0){let r=[];o.role.forEach(c=>{r.push({sys_role_id:c})}),o.sys_role_users=r}o.dept&&(o.sys_department_users=[{sys_department_id:o.dept}]),s.value?yield Q(y(p({},o),{id:a.value})):yield K(p({},o)),B(),t("success",{isUpdate:_(s),values:y(p({},o),{id:a.value})})}finally{h({confirmLoading:!1})}})}return{registerModal:P,registerForm:l,getTitle:k,handleSubmit:S}}});function ee(e,t,s,a,l,f){const d=I("BasicForm"),i=I("BasicModal");return z(),G(i,J(e.$attrs,{onRegister:e.registerModal,title:e.getTitle,onOk:e.handleSubmit}),{default:H(()=>[W(d,{onRegister:e.registerForm},null,8,["onRegister"])]),_:1},16,["onRegister","title","onOk"])}const se=D(Z,[["render",ee]]),_e=Object.freeze(Object.defineProperty({__proto__:null,default:se},Symbol.toStringTag,{value:"Module"}));export{se as A,_e as a,fe as c,me as d,pe as g,ge as s};
