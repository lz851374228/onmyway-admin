var N=Object.defineProperty,U=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var k=(t,a,e)=>a in t?N(t,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[a]=e,h=(t,a)=>{for(var e in a||(a={}))A.call(a,e)&&k(t,e,a[e]);if(I)for(var e of I(a))V.call(a,e)&&k(t,e,a[e]);return t},b=(t,a)=>U(t,q(a));var g=(t,a,e)=>new Promise((u,d)=>{var m=r=>{try{p(e.next(r))}catch(f){d(f)}},w=r=>{try{p(e.throw(r))}catch(f){d(f)}},p=r=>r.done?u(r.value):Promise.resolve(r.value).then(m,w);p((e=e.apply(t,a)).next())});import{B as E}from"./BasicForm-e261a333.js";import"./componentMap-db59878c.js";import{u as G}from"./useForm-84c9b2f9.js";import"./RadioButtonGroup-8412b0f8.js";import{s as K,a as T,u as $,c as O}from"./role-91c3552f.js";import{a6 as W}from"./index.js";import{n as j,d as z,k as v,u as c,e as H,_ as J,a9 as Q,aa as R,f as S,ad as X}from"./vue-625a50e2.js";import{aP as Y}from"./antd-d44a863f.js";import{a as Z,B as ee}from"./index-13c024b3.js";import{_ as te}from"./index-afd7ef17.js";import{g as ae}from"./menu-75f428b1.js";const ge=[{title:"角色名称",dataIndex:"name",width:200},{title:"角色值",dataIndex:"code",width:180},{title:"排序",dataIndex:"order",width:50},{title:"状态",dataIndex:"status",width:120,customRender:({record:t})=>(Reflect.has(t,"pendingStatus")||(t.pendingStatus=!1),j(Y,{checked:t.status==="1",checkedChildren:"停用",unCheckedChildren:"启用",loading:t.pendingStatus,onChange(a){t.pendingStatus=!0;const e=a?"1":"0",{createMessage:u}=W();K(t.id,e).then(()=>{t.status=e,u.success("已成功修改角色状态")}).catch(()=>{u.error("修改角色状态失败")}).finally(()=>{t.pendingStatus=!1})}}))},{title:"创建时间",dataIndex:"created_at",width:180},{title:"备注",dataIndex:"remark"}],ve=[{field:"name",label:"角色名称",component:"Input",colProps:{span:8}},{field:"status",label:"状态",component:"Select",componentProps:{options:[{label:"启用",value:"1"},{label:"停用",value:"0"}]},colProps:{span:8}}],se=[{field:"name",label:"角色名称",required:!0,component:"Input"},{field:"code",label:"角色值",required:!0,component:"Input"},{field:"order",label:"排序",component:"InputNumber",required:!0},{field:"status",label:"状态",component:"RadioButtonGroup",defaultValue:"1",componentProps:{options:[{label:"启用",value:"1"},{label:"停用",value:"0"}]}},{label:"备注",field:"remark",component:"InputTextArea"},{label:" ",field:"menu",slot:"menu",component:"Input"}],we=z({__name:"RoleDrawer",emits:["success","register"],setup(t,{emit:a}){const e=v(!0),u=v(null),d=v([]),m=v([]),[w,{resetFields:p,setFieldsValue:r,validate:f}]=G({labelWidth:90,baseColProps:{span:24},schemas:se,showActionButtonGroup:!1}),[x,{setDrawerProps:_,closeDrawer:C}]=Z(s=>g(this,null,function*(){if(p(),_({confirmLoading:!1}),c(d).length===0&&(d.value=yield ae()),e.value=!!(s!=null&&s.isUpdate),c(e)){u.value=s.record.id;const o=yield D(u.value);r(h({},o))}})),D=s=>g(this,null,function*(){let o=yield T({id:s}),l=o.sys_role_menus.map(i=>i.sys_menu_id),n=y(d.value,l,[]);return m.value=l.filter(i=>n.every(M=>M!=i)),b(h({},o),{menu:n})}),y=(s,o,l=[])=>{for(const n of s)n.children&&n.children.length!==0?y(n.children,o,l):l.push(...o.filter(i=>i===n.id));return l},B=(s,o)=>{m.value=o.halfCheckedKeys},P=H(()=>c(e)?"编辑角色":"新增角色");function F(){return g(this,null,function*(){try{const s=yield f();_({confirmLoading:!0}),s.sys_role_menus=yield L(s.menu,m.value),e.value?yield $(b(h({},s),{id:u.value})):yield O(h({},s)),C(),a("success")}finally{_({confirmLoading:!1})}})}const L=(s,o)=>{let l=[...s,...o],n=[];return Array.from(new Set(l)).forEach(i=>{n.push({sys_menu_id:i})}),n};return(s,o)=>(J(),Q(c(ee),X(s.$attrs,{onRegister:c(x),showFooter:"",title:P.value,width:"500px",onOk:F}),{default:R(()=>[S(c(E),{onRegister:c(w)},{menu:R(({model:l,field:n})=>[S(c(te),{value:l[n],"onUpdate:value":i=>l[n]=i,treeData:d.value,fieldNames:{title:"name",key:"id"},checkable:"",toolbar:"",title:"菜单分配",onCheck:B},null,8,["value","onUpdate:value","treeData"])]),_:1},8,["onRegister"])]),_:1},16,["onRegister","title"]))}});export{we as _,ge as c,ve as s};
