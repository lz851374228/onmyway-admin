var Re=Object.defineProperty;var Be=Object.getOwnPropertySymbols;var Le=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable;var be=(e,r,s)=>r in e?Re(e,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[r]=s,E=(e,r)=>{for(var s in r||(r={}))Le.call(r,s)&&be(e,s,r[s]);if(Be)for(var s of Be(r))Pe.call(r,s)&&be(e,s,r[s]);return e};var T=(e,r,s)=>new Promise((c,m)=>{var d=u=>{try{f(s.next(u))}catch(p){m(p)}},l=u=>{try{f(s.throw(u))}catch(p){m(p)}},f=u=>u.done?c(u.value):Promise.resolve(u.value).then(d,l);f((s=s.apply(e,r)).next())});import{_ as Se}from"./FormItem.vue_vue_type_script_lang-c8c36622.js";import{_ as Me,b as Ne,c as ke}from"./BasicForm.vue_vue_type_style_index_0_lang-03718be0.js";import{_ as $e,v as U,al as Z,o as ce,a9 as re,au as ee,aD as W,aE as he,ae as je,ac as _e,x as De,t as Ue,aF as we,az as fe,aC as Ee,aG as We,f as ze}from"./index.js";import{a8 as z,_ as G,a9 as X,aa as _,ae as ie,ad as x,ac as ae,a0 as He,f as le,R as H,E as de,a1 as ue,ag as Ye,u as n,g as qe,e as q,w as Q,ap as Ge,q as Ae,J as Ve,s as Ke,d as Xe,r as Ie,k as J,o as Je,an as Qe,$ as Ze,ab as pe,af as Te,ah as me,F as xe}from"./vue-625a50e2.js";import{d as et,h as tt,a as Oe}from"./helper-d16d18bc.js";import{M as K,ay as nt,ap as st,as as ot}from"./antd-d44a863f.js";import{u as at}from"./uniqBy-19b91793.js";import{a as rt}from"./index-0a9e2861.js";function it(e,r,s,c,m,d){const l=z("Button"),f=z("BasicArrow"),u=z("FormItem"),p=z("a-col");return e.showActionButtonGroup?(G(),X(p,ie(x({key:0},e.actionColOpt)),{default:_(()=>[He("div",{style:Ye([{width:"100%"},{textAlign:e.actionColOpt.style.textAlign}])},[le(u,null,{default:_(()=>[H(e.$slots,"resetBefore"),e.showResetButton?(G(),X(l,x({key:0,type:"default",class:"mr-2"},e.getResetBtnOptions,{onClick:e.resetAction}),{default:_(()=>[de(ue(e.getResetBtnOptions.text),1)]),_:1},16,["onClick"])):ae("",!0),H(e.$slots,"submitBefore"),e.showSubmitButton?(G(),X(l,x({key:1,type:"primary",class:"mr-2"},e.getSubmitBtnOptions,{onClick:e.submitAction}),{default:_(()=>[de(ue(e.getSubmitBtnOptions.text),1)]),_:1},16,["onClick"])):ae("",!0),H(e.$slots,"advanceBefore"),e.showAdvancedButton&&!e.hideAdvanceBtn?(G(),X(l,{key:2,type:"link",size:"small",onClick:e.toggleAdvanced},{default:_(()=>[de(ue(e.isAdvanced?e.t("component.form.putAway"):e.t("component.form.unfold"))+" ",1),le(f,{class:"ml-1",expand:!e.isAdvanced,up:""},null,8,["expand"])]),_:1},8,["onClick"])):ae("",!0),H(e.$slots,"advanceAfter")]),_:3})],4)]),_:3},16)):ae("",!0)}const ct=$e(Me,[["render",it]]);function lt(e,r,s){const c=/^\[(.+)\]$/;if(c.test(e)){const m=e.match(c);if(m&&m[1]){const d=m[1].split(",");return r=Array.isArray(r)?r:[r],d.forEach((l,f)=>{ee(s,l.trim(),r[f])}),!0}}}function ft(e,r,s){const c=/^\{(.+)\}$/;if(c.test(e)){const m=e.match(c);if(m&&m[1]){const d=m[1].split(",");return r=U(r)?r:{},d.forEach(l=>{ee(s,l.trim(),r[l.trim()])}),!0}}}function dt({defaultValueRef:e,getSchema:r,formModel:s,getProps:c}){function m(f){var p,F;if(!U(f))return{};const u={};for(const V of Object.entries(f)){let[,a]=V;const[O]=V;if(!O||Z(a)&&a.length===0||ce(a))continue;const $=n(c).transformDateFunc;U(a)&&(a=$==null?void 0:$(a)),Z(a)&&((p=a[0])!=null&&p.format)&&((F=a[1])!=null&&F.format)&&(a=a.map(M=>$==null?void 0:$(M))),re(a)&&(a===""?a=void 0:a=a.trim()),!lt(O,a,u)&&!ft(O,a,u)&&ee(u,O,a)}return d(u)}function d(f){const u=n(c).fieldMapToTime;if(!u||!Array.isArray(u))return f;for(const[p,[F,V],a="YYYY-MM-DD"]of u){if(!p||!F||!V)continue;if(!f[p]){Reflect.deleteProperty(f,p);continue}const[O,$]=f[p],[M,A]=Array.isArray(a)?a:[a,a];f[F]=W(O).format(M),f[V]=W($).format(A),Reflect.deleteProperty(f,p)}return f}function l(){const f=n(r),u={};f.forEach(p=>{const{defaultValue:F}=p;he(F)||(u[p.field]=F,s[p.field]===void 0&&(s[p.field]=F))}),e.value=K(u)}return{handleFormValues:m,initDefault:l}}const Y=24;function ut({advanceState:e,emit:r,getProps:s,getSchema:c,formModel:m,defaultValueRef:d}){const l=qe(),{realWidthRef:f,screenEnum:u,screenRef:p}=je(),F=q(()=>{if(!e.isAdvanced)return 0;const A=n(s).emptySpan||0;if(_e(A))return A;if(U(A)){const{span:B=0}=A,N=n(p);return A[N.toLowerCase()]||B||0}return 0}),V=De($,30);Q([()=>n(c),()=>e.isAdvanced,()=>n(f)],()=>{const{showAdvancedButton:A}=n(s);A&&V()},{immediate:!0});function a(A,B=0,N=!1){const S=n(f),C=parseInt(A.md)||parseInt(A.xs)||parseInt(A.sm)||A.span||Y,D=parseInt(A.lg)||C,k=parseInt(A.xl)||D,t=parseInt(A.xxl)||k;return S<=u.LG?B+=C:S<u.XL?B+=D:S<u.XXL?B+=k:B+=t,N?(e.hideAdvanceBtn=!1,B<=Y*2?(e.hideAdvanceBtn=!0,e.isAdvanced=!0):B>Y*2&&B<=Y*(n(s).autoAdvancedLine||3)?e.hideAdvanceBtn=!1:e.isLoad||(e.isLoad=!0,e.isAdvanced=!e.isAdvanced),{isAdvanced:e.isAdvanced,itemColSum:B}):B>Y*(n(s).alwaysShowLines||1)?{isAdvanced:e.isAdvanced,itemColSum:B}:{isAdvanced:!0,itemColSum:B}}const O=Ge({});function $(){var S;let A=0,B=0;const{baseColProps:N={}}=n(s);for(const C of n(c)){const{show:D,colProps:k}=C;let t=!0;if(Ue(D)&&(t=D),ce(D)&&(t=D({schema:C,model:m,field:C.field,values:E(E({},n(d)),m)})),t&&(k||N)){const{itemColSum:o,isAdvanced:g}=a(E(E({},N),k),A);A=o||0,g&&(B=A),O[C.field]=g}}(S=l==null?void 0:l.proxy)==null||S.$forceUpdate(),e.actionSpan=B%Y+n(F),a(n(s).actionColOptions||{span:Y},A,!0),r("advanced-change")}function M(){e.isAdvanced=!e.isAdvanced}return{handleToggleAdvanced:M,fieldsIsAdvancedMap:O}}function pt(e,r={}){const s=/^\[(.+)\]$/;if(s.test(e)){const c=e.match(s);if(c&&c[1]){const m=c[1].split(",");if(!m.length)return;const d=[];return m.forEach((l,f)=>{ee(d,f,r[l.trim()])}),d.filter(Boolean).length?d:void 0}}}function mt(e,r={}){const s=/^\{(.+)\}$/;if(s.test(e)){const c=e.match(s);if(c&&c[1]){const m=c[1].split(",");if(!m.length)return;const d={};return m.forEach(l=>{ee(d,l.trim(),r[l.trim()])}),Object.values(d).filter(Boolean).length?d:void 0}}}function ht({emit:e,getProps:r,formModel:s,getSchema:c,defaultValueRef:m,formElRef:d,schemaRef:l,handleFormValues:f}){function u(){return T(this,null,function*(){const{resetFunc:t,submitOnReset:o}=n(r);t&&ce(t)&&(yield t()),n(d)&&(Object.keys(s).forEach(i=>{const h=n(c).find(R=>R.field===i),v=(h==null?void 0:h.component)&&et.includes(h.component),b=K(m.value[i]);s[i]=v?b||"":b}),Ae(()=>C()),e("reset",Ve(s)),o&&k())})}function p(t){return T(this,null,function*(){const o=n(c).map(v=>v.field).filter(Boolean),g=".",i=o.filter(v=>String(v).indexOf(g)>=0),h=[];o.forEach(v=>{const b=n(c).find(w=>w.field===v);let R=nt(t,v);const te=Reflect.has(t,v);R=tt(b==null?void 0:b.component,R);const{componentProps:ne}=b||{};let L=ne;typeof ne=="function"&&(L=L({formModel:n(s)}));const se=pt(v,t)||mt(v,t);if(te||se){const w=se||R;if(B(v))if(Array.isArray(w)){const j=[];for(const y of w)j.push(y?W(y):null);n(s)[v]=j}else n(s)[v]=w?L!=null&&L.valueFormat?w:W(w):null;else n(s)[v]=w;L!=null&&L.onChange&&(L==null||L.onChange(w)),h.push(v)}else i.forEach(w=>{try{const j=w.split(".").reduce((y,I)=>y[I],t);we(j)&&(n(s)[w]=n(j),h.push(w))}catch(j){we(m.value[w])&&(n(s)[w]=K(n(m.value[w])))}})}),N(h).catch(v=>{})})}function F(t){return T(this,null,function*(){const o=K(n(c));if(!t)return;let g=re(t)?[t]:t;re(t)&&(g=[t]);for(const i of g)V(i,o);l.value=o})}function V(t,o){if(re(t)){const g=o.findIndex(i=>i.field===t);g!==-1&&(delete s[t],o.splice(g,1))}}function a(t,o,g=!1){return T(this,null,function*(){const i=K(n(c)),h=Array.isArray(t)?t.map(R=>R.field):[t.field];if(i.find(R=>h.includes(R.field))){fe("There are schemas that have already been added");return}const v=i.findIndex(R=>R.field===o),b=U(t)?[t]:t;if(!o||v===-1||g){g?i.unshift(...b):i.push(...b),l.value=i,M(t);return}v!==-1&&i.splice(v+1,0,...b),M(t),l.value=i})}function O(t){return T(this,null,function*(){let o=[];if(U(t)&&o.push(t),Z(t)&&(o=[...t]),!o.every(i=>i.component==="Divider"||Reflect.has(i,"field")&&i.field)){fe("All children of the form Schema array that need to be updated must contain the `field` field");return}l.value=o})}function $(t){return T(this,null,function*(){let o=[];if(U(t)&&o.push(t),Z(t)&&(o=[...t]),!o.every(h=>h.component==="Divider"||Reflect.has(h,"field")&&h.field)){fe("All children of the form Schema array that need to be updated must contain the `field` field");return}const i=[];n(c).forEach(h=>{let v;if(o.forEach(b=>{h.field===b.field&&(v=b)}),v!==void 0&&h.field===v.field){const b=Ee(h,v);i.push(b)}else i.push(h)}),M(i),l.value=at(i,"field")})}function M(t){let o=[];U(t)&&o.push(t),Z(t)&&(o=[...t]);const g={},i=A();o.forEach(h=>{h.component!="Divider"&&Reflect.has(h,"field")&&h.field&&!he(h.defaultValue)&&(!(h.field in i)||he(i[h.field])||We(i[h.field]))&&(g[h.field]=h.defaultValue)}),p(g)}function A(){return n(d)?f(Ve(n(s))):{}}function B(t){return n(c).some(o=>o.field===t?Oe.includes(o.component):!1)}function N(t){return T(this,null,function*(){var o;return(o=n(d))==null?void 0:o.validateFields(t)})}function S(t){return T(this,null,function*(){var o;return yield(o=n(d))==null?void 0:o.validate(t)})}function C(t){return T(this,null,function*(){var o;yield(o=n(d))==null?void 0:o.clearValidate(t)})}function D(t,o){return T(this,null,function*(){var g;yield(g=n(d))==null?void 0:g.scrollToField(t,o)})}function k(t){return T(this,null,function*(){t&&t.preventDefault();const{submitFunc:o}=n(r);if(o&&ce(o)){yield o();return}if(n(d))try{const i=yield S(),h=f(i);e("submit",h)}catch(i){if((i==null?void 0:i.outOfDate)===!1&&(i!=null&&i.errorFields))return;throw new Error(i)}})}return{handleSubmit:k,clearValidate:C,validate:S,validateFields:N,getFieldsValue:A,updateSchema:$,resetSchema:O,appendSchemaByField:a,removeSchemaByField:F,resetFields:u,setFieldsValue:p,scrollToField:D}}function At(m){return T(this,arguments,function*({getSchema:e,getProps:r,formElRef:s,isInitedDefault:c}){Ke(()=>T(this,null,function*(){if(n(c)||!n(r).autoFocusFirstItem)return;yield Ae();const d=n(e),l=n(s),f=l==null?void 0:l.$el;if(!l||!f||!d||d.length===0||!d[0].component.includes("Input"))return;const p=f.querySelector(".ant-row:first-child input");p&&(p==null||p.focus())}))})}const yt=Xe({name:"BasicForm",components:{FormItem:Se,Form:st,Row:ot,FormAction:ct},props:Ne,emits:["advanced-change","reset","submit","register","field-value-change"],setup(e,{emit:r,attrs:s}){const c=Ie({}),m=rt(),d=Ie({isAdvanced:!0,hideAdvanceBtn:!1,isLoad:!1,actionSpan:6}),l=J({}),f=J(!1),u=J({}),p=J(null),F=J(null),{prefixCls:V}=ze("basic-form"),a=q(()=>E(E({},e),n(u))),O=q(()=>[V,{[`${V}--compact`]:n(a).compact}]),$=q(()=>{const{baseRowStyle:y={},rowProps:I}=n(a);return E({style:y},I)}),M=q(()=>E(E(E({},s),e),n(a))),A=q(()=>{const y=n(p)||n(a).schemas;for(const I of y){const{defaultValue:P,component:ye,componentProps:ve,isHandleDateDefaultValue:Ce=!0}=I;if(Ce&&P&&Oe.includes(ye)){const oe=ve?ve.valueFormat:null;if(!Array.isArray(P))I.defaultValue=oe?W(P).format(oe):W(P);else{const ge=[];P.forEach(Fe=>{ge.push(oe?W(Fe).format(oe):W(Fe))}),I.defaultValue=ge}}}return n(a).showAdvancedButton?K(y.filter(I=>I.component!=="Divider")):K(y)}),{handleToggleAdvanced:B,fieldsIsAdvancedMap:N}=ut({advanceState:d,emit:r,getProps:a,getSchema:A,formModel:c,defaultValueRef:l}),{handleFormValues:S,initDefault:C}=dt({getProps:a,defaultValueRef:l,getSchema:A,formModel:c});At({getSchema:A,getProps:a,isInitedDefault:f,formElRef:F});const{handleSubmit:D,setFieldsValue:k,clearValidate:t,validate:o,validateFields:g,getFieldsValue:i,updateSchema:h,resetSchema:v,appendSchemaByField:b,removeSchemaByField:R,resetFields:te,scrollToField:ne}=ht({emit:r,getProps:a,formModel:c,getSchema:A,defaultValueRef:l,formElRef:F,schemaRef:p,handleFormValues:S});ke({resetAction:te,submitAction:D}),Q(()=>n(a).model,()=>{const{model:y}=n(a);y&&k(y)},{immediate:!0}),Q(()=>n(a).schemas,y=>{v(y!=null?y:[])}),Q(()=>A.value,y=>{Ae(()=>{var I;(I=m==null?void 0:m.redoModalHeight)==null||I.call(m)}),!n(f)&&y!=null&&y.length&&(C(),f.value=!0)}),Q(()=>c,De(()=>{n(a).submitOnChange&&D()},300),{deep:!0});function L(y){return T(this,null,function*(){u.value=Ee(n(u)||{},y)})}function se(y,I,P){c[y]=I,r("field-value-change",y,I),P&&P.itemProps&&!P.itemProps.autoLink&&g([y]).catch(ye=>{})}function w(y){const{autoSubmitOnEnter:I}=n(a);if(I&&y.key==="Enter"&&y.target&&y.target instanceof HTMLElement){const P=y.target;P&&P.tagName&&P.tagName.toUpperCase()=="INPUT"&&D()}}const j={getFieldsValue:i,setFieldsValue:k,resetFields:te,updateSchema:h,resetSchema:v,setProps:L,removeSchemaByField:R,appendSchemaByField:b,clearValidate:t,validateFields:g,validate:o,submit:D,scrollToField:ne};return Je(()=>{C(),r("register",j)}),E({getBindValue:M,handleToggleAdvanced:B,handleEnterPress:w,formModel:c,defaultValueRef:l,advanceState:d,getRow:$,getProps:a,formElRef:F,getSchema:A,formActionType:j,setFormModel:se,getFormClass:O,getFormActionBindProps:q(()=>E(E({},a.value),d)),fieldsIsAdvancedMap:N},j)}});function vt(e,r,s,c,m,d){const l=z("FormItem"),f=z("FormAction"),u=z("Row"),p=z("Form");return G(),X(p,x(e.getBindValue,{class:e.getFormClass,ref:"formElRef",model:e.formModel,onKeypress:Qe(e.handleEnterPress,["enter"])}),{default:_(()=>[le(u,ie(me(e.getRow)),{default:_(()=>[H(e.$slots,"formHeader"),(G(!0),Ze(xe,null,pe(e.getSchema,F=>(G(),X(l,{key:F.field,isAdvanced:e.fieldsIsAdvancedMap[F.field],tableAction:e.tableAction,formActionType:e.formActionType,schema:F,formProps:e.getProps,allDefaultValues:e.defaultValueRef,formModel:e.formModel,setFormModel:e.setFormModel},Te({_:2},[pe(Object.keys(e.$slots),V=>({name:V,fn:_(a=>[H(e.$slots,V,ie(me(a||{})))])}))]),1032,["isAdvanced","tableAction","formActionType","schema","formProps","allDefaultValues","formModel","setFormModel"]))),128)),le(f,x(e.getFormActionBindProps,{onToggleAdvanced:e.handleToggleAdvanced}),Te({_:2},[pe(["resetBefore","submitBefore","advanceBefore","advanceAfter"],F=>({name:F,fn:_(V=>[H(e.$slots,F,ie(me(V||{})))])}))]),1040,["onToggleAdvanced"]),H(e.$slots,"formFooter")]),_:3},16)]),_:3},16,["class","model","onKeypress"])}const Dt=$e(yt,[["render",vt]]);export{Dt as B};
